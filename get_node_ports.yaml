- name: Get a list of services
  k8s_info:
    kind: Service
    namespace: "{{ k8s_namespace }}"
  register: k8s_services
  
- name: "query node ports cluster names"
  debug:
    var: item
  loop: "{{ k8s_services |  json_query('resources[*].spec.ports[?nodePort!=None].nodePort') }}"
  register: node_port
  

- set_stats:
    data:
      node_port: "{{ node_port.results }}"
