- name: Get a list of services
  k8s_info:
    kind: Service
    namespace: "{{ k8s_namespace }}"
  register: k8s_services
  
- name: "query node ports cluster names"
  debug:
    var: item
  loop: "{{ k8s_services |  json_query('resources[?spec.type==`NodePort`].spec.ports[*].nodePort') }}"
  register: node_ports
 
- debug:
    var: node_ports.results
  

# - set_stats:
#     data:
#       node_port: "{{node_ports.results}}"
