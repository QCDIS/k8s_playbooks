- name: Get a list of services
  k8s_info:
    kind: Service
    namespace: "{{ k8s_namespace }}"
  register: k8s_services
  
- name: "query node ports cluster names"
  debug:
    var: item
  loop: "{{ k8s_services |  json_query('resources[?spec.type==`NodePort`].spec.ports[*].nodePort') }}"
  register: node_ports
  
# - local_action: copy content={{ node_ports }} dest=/tmp/node_ports_"{{ k8s_namespace }}".json

- copy:
    content: "{{ node_ports }}"
    dest: /tmp/node_ports_"{{ k8s_namespace }}".json
  
   
