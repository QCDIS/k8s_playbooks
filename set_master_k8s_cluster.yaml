---        
- hosts: master
  gather_facts: no
  vars:
      ansible_python_interpreter: /usr/bin/python3
  tasks:

    - include: k8s-master.yaml

    - debug:
        var: kuctl_weave_output
        
- hosts: master
  gather_facts: no
  tasks: 

    - name: get nodes
      shell: kubectl get nodes
      register: nodes_out
              
    - name: print nodes
      debug:
        var: nodes_out
        
        
    - name: get api key
      shell: kubectl describe secret $(kubectl get secrets | grep default | cut -f1 -d ' ') | grep -E '^token' | cut -f2 -d':' | tr -d '\t'
      register: api_key
              
    - name: print api_key
      debug:
        var: api_key
